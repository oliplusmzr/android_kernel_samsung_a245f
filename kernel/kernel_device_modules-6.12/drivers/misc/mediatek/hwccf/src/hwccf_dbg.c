// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright (c) 2024 MediaTek Inc.
 */

#include <linux/seq_file.h>
#include <linux/proc_fs.h>
#include <hwccf_provider.h> /* Kernel only */
#include <hwccf_provider_data.h> /* Kernel only */
#include <hwccf_dbg.h> /* Kernel only */

#include <linux/arm-smccc.h>
#include <linux/soc/mediatek/mtk_sip_svc.h>
#include <mtk-scpsys.h>

struct seq_file;

#define CMDFN(_cmd, _fn) {      \
	.cmd = _cmd,            \
	.fn = _fn,              \
}

struct cmd_fn {
	const char *cmd;
	int (*fn)(struct seq_file *s, void *v);
};

static char last_cmd[128] = "null";
static int hwccf_cmds(struct seq_file *s, void *v);

static int hwccf_plat_dbg(void *hwccf_data)
{
	struct hwccf_ops_data *hwccf_ops_data = (struct hwccf_ops_data *)hwccf_data;
	struct arm_smccc_res res;
	uint32_t hwccf_smc_type;

	if (hwccf_data == NULL)
		return 0;

	pr_info("[HWCCF_DBG] %s: %s, %u, %u, %u, is smc = %d\n", __func__,
		hwccf_ops_data->hwccf_type == AP_HWCCF ? "AP" : "MM",
		hwccf_ops_data->hwccf_resource_id,
		hwccf_ops_data->hwccf_vote_type,
		hwccf_ops_data->hwccf_vote_data,
		hwccf_ops_data->is_smc);
	if (hwccf_ops_data->is_smc) {
		if (hwccf_ops_data->is_irq_voter) {
			if (hwccf_ops_data->hwccf_type == AP_HWCCF)
				hwccf_smc_type = MTK_HWCCF_KERNEL_OP_AP_IRQ_VOTER;
			else
				hwccf_smc_type = hwccf_ops_data->is_nowait ?
					MTK_HWCCF_KERNEL_OP_MM_IRQ_VOTER_NO_WAIT :
					MTK_HWCCF_KERNEL_OP_MM_IRQ_VOTER;
		} else {
			if (hwccf_ops_data->hwccf_type == AP_HWCCF)
				hwccf_smc_type = MTK_HWCCF_KERNEL_OP_AP_VOTER;
			else
				hwccf_smc_type = MTK_HWCCF_KERNEL_OP_MM_VOTER;
		}
		arm_smccc_smc(MTK_SIP_KERNEL_HWCCF_CONTROL,
					hwccf_smc_type,
					hwccf_ops_data->hwccf_resource_id,
					hwccf_ops_data->hwccf_vote_type,
					hwccf_ops_data->hwccf_vote_data,
					0, 0, 0, &res);
	} else {
		if (hwccf_ops_data->is_irq_voter) {
			hwccf_irq_voter_ctrl(hwccf_ops_data->hwccf_type,
				hwccf_ops_data->hwccf_resource_id,
				hwccf_ops_data->hwccf_vote_type,
				hwccf_ops_data->hwccf_vote_data);
		} else {
			hwccf_voter_ctrl(hwccf_ops_data->hwccf_type,
				hwccf_ops_data->hwccf_resource_id,
				hwccf_ops_data->hwccf_vote_type,
				hwccf_ops_data->hwccf_vote_data);
		}
	}
	return 0;
}

static int clkdbg_hwccf(struct seq_file *s, void *v)
{
	char cmd[sizeof(last_cmd)];
	char *c = cmd;
	char *hwccf_cmd_str;
	char *hwccf_type_str;
	char *resource_id_str;
	char *vote_type_str;
	char *bit_str;
	unsigned long resource_id = 0, bit = 0;
	int r;
	struct hwccf_ops_data hwccf_data;


	strscpy(cmd, last_cmd, sizeof(cmd));
	cmd[sizeof(cmd) - 1UL] = '\0';

	hwccf_cmd_str = strsep(&c, " ");

	if (hwccf_cmd_str == NULL)
		return 0;

	hwccf_data.is_nowait = 0;
	if (strcmp(hwccf_cmd_str, "hwccf_voter") == 0) {
		hwccf_data.is_irq_voter = 0;
		hwccf_data.is_smc = 0;
	} else if (strcmp(hwccf_cmd_str, "hwccf_voter_smc") == 0) {
		hwccf_data.is_irq_voter = 0;
		hwccf_data.is_smc = 1;
	} else if (strcmp(hwccf_cmd_str, "hwccf_irq_voter") == 0) {
		hwccf_data.is_irq_voter = 1;
		hwccf_data.is_smc = 0;
	} else if (strcmp(hwccf_cmd_str, "hwccf_irq_voter_smc") == 0) {
		hwccf_data.is_irq_voter = 1;
		hwccf_data.is_smc = 1;
	} else if (strcmp(hwccf_cmd_str, "hwccf_irq_voter_no_wait_smc") == 0) {
		hwccf_data.is_irq_voter = 1;
		hwccf_data.is_smc = 1;
		hwccf_data.is_nowait = 1;
	}

	hwccf_type_str = strsep(&c, " ");
	resource_id_str = strsep(&c, " ");
	vote_type_str = strsep(&c, " ");
	bit_str = strsep(&c, " ");

	if (hwccf_type_str == NULL ||
	    resource_id_str == NULL ||
	    vote_type_str == NULL ||
	    bit_str == NULL)
		return 0;

	if (strcmp(hwccf_type_str, "AP_HW_CCF") == 0)
		hwccf_data.hwccf_type = AP_HWCCF;
	else if (strcmp(hwccf_type_str, "MM_HW_CCF") == 0)
		hwccf_data.hwccf_type = MM_HWCCF;
	else
		return 0;

	r = kstrtoul(resource_id_str, 0, &resource_id);
	if (r == 0)
		hwccf_data.hwccf_resource_id = resource_id;
	else
		return 0;

	if (strcmp(vote_type_str, "HWCCF_VOTE") == 0)
		hwccf_data.hwccf_vote_type = HWCCF_VOTE;
	else if (strcmp(vote_type_str, "HWCCF_UNVOTE") == 0)
		hwccf_data.hwccf_vote_type = HWCCF_UNVOTE;
	else
		return 0;

	r = kstrtoul(bit_str, 0, &bit);
	if (r == 0)
		hwccf_data.hwccf_vote_data = bit;
	else
		return 0;

	seq_printf(s, "%s; %s resource id %lu %s bit %lu\n",
		hwccf_cmd_str, hwccf_type_str, resource_id, vote_type_str, bit);

	r = hwccf_plat_dbg((void *)&hwccf_data);

	return r;
}

#define REGNAME(_ofs, _name)     \
	{.ofs = _ofs, .name = #_name }

static struct regname hwccf_dump_regs[] = {
	REGNAME(0x50, HW_CCF_INT_STATUS),
	REGNAME(0x1544, HW_CCF_APB_M_REG5),
	REGNAME(0x10000, HW_CCF_STATUS),
	REGNAME(0x10004, HW_CCF_OUTPUT_STATUS),
	REGNAME(0x10008, HW_CCF_FSM_REQ_ACK),
	REGNAME(0x13900, HW_CCF_MTCMOS_PM_REQ_0),
	REGNAME(0x13904, HW_CCF_MTCMOS_PM_REQ_1),
	REGNAME(0x12900, HW_CCF_MTCMOS_PM_ACK_0),
	REGNAME(0x12904, HW_CCF_MTCMOS_PM_ACK_1),
	REGNAME(0x14000, HW_CCF_MUX_CKSYS_REQ_0),
	REGNAME(0x13300, HW_CCF_MUX_CKSYS_ACK_0),
	REGNAME(0x141F0, HW_CCF_CG_FSM_TIMEOUT_DIV_CNT0),
	REGNAME(0x141F4, HW_CCF_MTCMOS_FSM_TIMEOUT_DIV_CNT0),
	REGNAME(0x141F8, HW_CCF_MUX_FSM_TIMEOUT_DIV_CNT0),
	REGNAME(0x141FC, HW_CCF_IRQ_TIMEOUT_DIV_CNT0),
	REGNAME(0x14200, HW_CCF_CG_FSM_TIMEOUT_DBG),
	REGNAME(0x14204, HW_CCF_CG_FSM_TIMEOUT0_DBG0),
	REGNAME(0x14208, HW_CCF_MTCMOS_FSM_TIMEOUT_DBG),
	REGNAME(0x1420C, HW_CCF_MTCMOS_FSM_TIMEOUT_DBG0),
	REGNAME(0x14210, HW_CCF_MTCMOS_FSM_TIMEOUT_DBG1),
	REGNAME(0x14214, HW_CCF_MUX_FSM_TIMEOUT_DBG),
	REGNAME(0x14218, HW_CCF_MUX_FSM_TIMEOUT_DBG0),
	REGNAME(0x3FB0, HW_CCF_DUMMY_SET_0),
	REGNAME(0x3FB4, HW_CCF_DUMMY_CLR_0),
	REGNAME(0x3FB8, HW_CCF_DUMMY_ENABLE_0),
	REGNAME(0x14240, HW_CCF_ECO_OPEN_0),

	/* MM HWCCF History Register */
	REGNAME(0x128D0, HW_CCF_CG_HIS_INDEX_POINTER),
	REGNAME(0x12100, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_0),
	REGNAME(0x12104, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_1),
	REGNAME(0x12108, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_2),
	REGNAME(0x1210C, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_3),
	REGNAME(0x12110, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_4),
	REGNAME(0x12114, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_5),
	REGNAME(0x12118, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_6),
	REGNAME(0x1211C, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_7),
	REGNAME(0x12120, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_8),
	REGNAME(0x12124, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_9),
	REGNAME(0x12128, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_10),
	REGNAME(0x1212C, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_11),
	REGNAME(0x12130, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_12),
	REGNAME(0x12134, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_13),
	REGNAME(0x12138, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_14),
	REGNAME(0x1213C, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_15),
	REGNAME(0x12140, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_16),
	REGNAME(0x12144, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_17),
	REGNAME(0x12148, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_18),
	REGNAME(0x1214C, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_19),
	REGNAME(0x12150, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_20),
	REGNAME(0x12154, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_21),
	REGNAME(0x12158, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_22),
	REGNAME(0x1215C, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_23),
	REGNAME(0x12160, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_24),
	REGNAME(0x12164, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_25),
	REGNAME(0x12168, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_26),
	REGNAME(0x1216C, HW_CCF_XPU_VOTE_CG_ADDR_HISTORY_27),
	REGNAME(0x1245C, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_0),
	REGNAME(0x12460, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_1),
	REGNAME(0x12464, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_2),
	REGNAME(0x12468, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_3),
	REGNAME(0x1246C, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_4),
	REGNAME(0x12470, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_5),
	REGNAME(0x12474, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_6),
	REGNAME(0x12478, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_7),
	REGNAME(0x1247C, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_8),
	REGNAME(0x12480, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_9),
	REGNAME(0x12484, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_10),
	REGNAME(0x12488, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_11),
	REGNAME(0x1248C, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_12),
	REGNAME(0x12490, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_13),
	REGNAME(0x12494, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_14),
	REGNAME(0x12498, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_15),
	REGNAME(0x1249C, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_16),
	REGNAME(0x124A0, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_17),
	REGNAME(0x124A4, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_18),
	REGNAME(0x124A8, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_19),
	REGNAME(0x124AC, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_20),
	REGNAME(0x124B0, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_21),
	REGNAME(0x124B4, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_22),
	REGNAME(0x124B8, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_23),
	REGNAME(0x124BC, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_24),
	REGNAME(0x124C0, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_25),
	REGNAME(0x124C4, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_26),
	REGNAME(0x124C8, HW_CCF_XPU_VOTE_CG_DATA_HISTORY_27),


	REGNAME(0x124CC, HW_CCF_VOTE_IRQ_HIS_INDEX_POINTER ),
	REGNAME(0x124D0, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_0),
	REGNAME(0x124D4, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_1),
	REGNAME(0x124D8, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_2),
	REGNAME(0x124DC, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_3),
	REGNAME(0x124E0, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_4),
	REGNAME(0x124E4, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_5),
	REGNAME(0x124E8, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_6),
	REGNAME(0x124EC, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_7),
	REGNAME(0x124F0, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_8),
	REGNAME(0x124F4, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_9),
	REGNAME(0x124F8, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_10),
	REGNAME(0x124FC, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_11),
	REGNAME(0x12500, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_12),
	REGNAME(0x12504, HW_CCF_XPU_VOTE_IRQ_ADDR_HISTORY_13),
	REGNAME(0x12508, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_0),
	REGNAME(0x1250C, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_1),
	REGNAME(0x12510, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_2),
	REGNAME(0x12514, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_3),
	REGNAME(0x12518, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_4),
	REGNAME(0x1251C, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_5),
	REGNAME(0x12520, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_6),
	REGNAME(0x12524, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_7),
	REGNAME(0x12528, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_8),
	REGNAME(0x1252C, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_9),
	REGNAME(0x12530, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_10),
	REGNAME(0x12534, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_11),
	REGNAME(0x12538, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_12),
	REGNAME(0x1253C, HW_CCF_XPU_VOTE_IRQ_DATA_HISTORY_13),

	REGNAME(0x12438, HW_CCF_INPUT_TIMELINE_POINTER ),
	REGNAME(0x1243c, HW_CCF_INPUT_TIMELINE_HISTORY_4_0),
	REGNAME(0x12440, HW_CCF_INPUT_TIMELINE_HISTORY_9_5),
	REGNAME(0x12444, HW_CCF_INPUT_TIMELINE_HISTORY_14_10),
	REGNAME(0x12448, HW_CCF_INPUT_TIMELINE_HISTORY_19_15),
	REGNAME(0x1244C, HW_CCF_INPUT_TIMELINE_HISTORY_14_20),
	REGNAME(0x12450, HW_CCF_INPUT_TIMELINE_HISTORY_29_25),
	REGNAME(0x12454, HW_CCF_INPUT_TIMELINE_HISTORY_34_30),
	REGNAME(0x12458, HW_CCF_INPUT_TIMELINE_HISTORY_39_35),

	REGNAME(0x12838, HW_CCF_APB_M_DEBUG_0),
	REGNAME(0x128BC, HW_CCF_INDEX_POINTER ),
	REGNAME(0x1283C, HW_CCF_ADDR_HISTORY_0),
	REGNAME(0x12840, HW_CCF_ADDR_HISTORY_1),
	REGNAME(0x12844, HW_CCF_ADDR_HISTORY_2),
	REGNAME(0x12848, HW_CCF_ADDR_HISTORY_3),
	REGNAME(0x1284C, HW_CCF_ADDR_HISTORY_4),
	REGNAME(0x12850, HW_CCF_ADDR_HISTORY_5),
	REGNAME(0x12854, HW_CCF_ADDR_HISTORY_6),
	REGNAME(0x12858, HW_CCF_ADDR_HISTORY_7),
	REGNAME(0x1285C, HW_CCF_ADDR_HISTORY_8),
	REGNAME(0x12860, HW_CCF_ADDR_HISTORY_9),
	REGNAME(0x12864, HW_CCF_ADDR_HISTORY_10),
	REGNAME(0x12868, HW_CCF_ADDR_HISTORY_11),
	REGNAME(0x1286C, HW_CCF_ADDR_HISTORY_12),
	REGNAME(0x12870, HW_CCF_ADDR_HISTORY_13),
	REGNAME(0x12874, HW_CCF_ADDR_HISTORY_14),
	REGNAME(0x12878, HW_CCF_ADDR_HISTORY_15),
	REGNAME(0x1287C, HW_CCF_DATA_HISTORY_0),
	REGNAME(0x12880, HW_CCF_DATA_HISTORY_1),
	REGNAME(0x12884, HW_CCF_DATA_HISTORY_2),
	REGNAME(0x12888, HW_CCF_DATA_HISTORY_3),
	REGNAME(0x1288C, HW_CCF_DATA_HISTORY_4),
	REGNAME(0x12890, HW_CCF_DATA_HISTORY_5),
	REGNAME(0x12894, HW_CCF_DATA_HISTORY_6),
	REGNAME(0x12898, HW_CCF_DATA_HISTORY_7),
	REGNAME(0x1289C, HW_CCF_DATA_HISTORY_8),
	REGNAME(0x128A0, HW_CCF_DATA_HISTORY_9),
	REGNAME(0x128A4, HW_CCF_DATA_HISTORY_10),
	REGNAME(0x128A8, HW_CCF_DATA_HISTORY_11),
	REGNAME(0x128AC, HW_CCF_DATA_HISTORY_12),
	REGNAME(0x128B0, HW_CCF_DATA_HISTORY_13),
	REGNAME(0x128B4, HW_CCF_DATA_HISTORY_14),
	REGNAME(0x128B8, HW_CCF_DATA_HISTORY_15),

	/* MM HWCCF Voting Status Register */
	REGNAME(0x11318, HW_CCF_MTCMOS_ENABLE_0),
	REGNAME(0x1131c, HW_CCF_MTCMOS_STATUS_0),
	REGNAME(0x1132c, HW_CCF_MTCMOS_DONE_0),
	REGNAME(0x11330, HW_CCF_MTCMOS_ENABLE_1),
	REGNAME(0x11334, HW_CCF_MTCMOS_STATUS_1),
	REGNAME(0x11344, HW_CCF_MTCMOS_DONE_1),
	REGNAME(0x13800, HW_CCF_MTCMOS_IRQ_ENABLE_0),
	REGNAME(0x13804, HW_CCF_MTCMOS_IRQ_STATUS_0),
	REGNAME(0x13808, HW_CCF_MTCMOS_IRQ_ENABLE_1),
	REGNAME(0x1380C, HW_CCF_MTCMOS_IRQ_STATUS_1),
	REGNAME(0x13700, HW_CCF_ALL_MTCMOS_ENABLE_0),
	REGNAME(0x13704, HW_CCF_ALL_MTCMOS_STATUS_0),
	REGNAME(0x13708, HW_CCF_ALL_MTCMOS_ENABLE_1),
	REGNAME(0x1370C, HW_CCF_ALL_MTCMOS_STATUS_1),
	REGNAME(0x11358, HW_CCF_BACKUP1_ENABLE),
	REGNAME(0x1135c, HW_CCF_BACKUP1_STATUS),
	REGNAME(0x1136c, HW_CCF_BACKUP1_DONE),
	REGNAME(0x11370, HW_CCF_BACKUP2_ENABLE),
	REGNAME(0x11374, HW_CCF_BACKUP2_STATUS),
	REGNAME(0x11384, HW_CCF_BACKUP2_DONE),
	REGNAME(0x11300, HW_CCF_BACKUP3_ENABLE),
	REGNAME(0x11304, HW_CCF_BACKUP3_STATUS),
	REGNAME(0x11314, HW_CCF_BACKUP3_DONE),
	REGNAME(0x12030, HW_CCF_MUX_PWR_STATUS_0_31),
	REGNAME(0x12330, HW_CCF_MUX_PWR_ENABLE_0_31),
	REGNAME(0x12730, HW_CCF_MUX_PWR_DONE_0_31),
	REGNAME(0x13430, HW_CCF_IRQ_MUX_PWR_ENABLE_0_31),
	REGNAME(0x13530, HW_CCF_IRQ_MUX_PWR_STATUS_0_31),
	REGNAME(0x13630, HW_CCF_IRQ_MUX_PWR_DONE_0_31),
	REGNAME(0x14104, HW_CCF_ALL_MUX_ENABLE_0_31),
	REGNAME(0x14114, HW_CCF_ALL_MUX_STATUS_0_31),
	REGNAME(0x13400, HW_CCF_IRQ_MUX_SEL_ENABLE_7_0),
	REGNAME(0x13404, HW_CCF_IRQ_MUX_SEL_ENABLE_15_8),
	REGNAME(0x13408, HW_CCF_IRQ_MUX_SEL_ENABLE_23_16),
	REGNAME(0x13500, HW_CCF_IRQ_MUX_SEL_STA_7_0),
	REGNAME(0x13504, HW_CCF_IRQ_MUX_SEL_STA_15_8),
	REGNAME(0x13508, HW_CCF_IRQ_MUX_SEL_STA_23_16),
	REGNAME(0x13600, HW_CCF_IRQ_MUX_SEL_DONE_7_0),
	REGNAME(0x13604, HW_CCF_IRQ_MUX_SEL_DONE_15_8),
	REGNAME(0x13608, HW_CCF_IRQ_MUX_SEL_DONE_23_16),
	REGNAME(0x20800, XPU0_POLL_CG_DONE_31_0),
	REGNAME(0x20804, XPU0_POLL_CG_DONE_63_32),
	REGNAME(0x12200, HW_CCF_CG_ENABLE_0),
	REGNAME(0x12204, HW_CCF_CG_ENABLE_1),
	REGNAME(0x12208, HW_CCF_CG_ENABLE_2),
	REGNAME(0x1220C, HW_CCF_CG_ENABLE_3),
	REGNAME(0x12210, HW_CCF_CG_ENABLE_4),
	REGNAME(0x12214, HW_CCF_CG_ENABLE_5),
	REGNAME(0x12218, HW_CCF_CG_ENABLE_6),
	REGNAME(0x1221C, HW_CCF_CG_ENABLE_7),
	REGNAME(0x12220, HW_CCF_CG_ENABLE_8),
	REGNAME(0x12224, HW_CCF_CG_ENABLE_9),
	REGNAME(0x12228, HW_CCF_CG_ENABLE_10),
	REGNAME(0x1222C, HW_CCF_CG_ENABLE_11),
	REGNAME(0x12230, HW_CCF_CG_ENABLE_12),
	REGNAME(0x12234, HW_CCF_CG_ENABLE_13),
	REGNAME(0x12238, HW_CCF_CG_ENABLE_14),
	REGNAME(0x1223C, HW_CCF_CG_ENABLE_15),
	REGNAME(0x12240, HW_CCF_CG_ENABLE_16),
	REGNAME(0x12244, HW_CCF_CG_ENABLE_17),
	REGNAME(0x12248, HW_CCF_CG_ENABLE_18),
	REGNAME(0x1224C, HW_CCF_CG_ENABLE_19),
	REGNAME(0x12250, HW_CCF_CG_ENABLE_20),
	REGNAME(0x12254, HW_CCF_CG_ENABLE_21),
	REGNAME(0x12258, HW_CCF_CG_ENABLE_22),
	REGNAME(0x1225C, HW_CCF_CG_ENABLE_23),
	REGNAME(0x12260, HW_CCF_CG_ENABLE_24),
	REGNAME(0x12264, HW_CCF_CG_ENABLE_25),
	REGNAME(0x12268, HW_CCF_CG_ENABLE_26),
	REGNAME(0x1226C, HW_CCF_CG_ENABLE_27),
	REGNAME(0x12270, HW_CCF_CG_ENABLE_28),
	REGNAME(0x12274, HW_CCF_CG_ENABLE_29),
	REGNAME(0x12278, HW_CCF_CG_ENABLE_30),
	REGNAME(0x1227C, HW_CCF_CG_ENABLE_31),
	REGNAME(0x12280, HW_CCF_CG_ENABLE_32),
	REGNAME(0x12284, HW_CCF_CG_ENABLE_33),
	REGNAME(0x12288, HW_CCF_CG_ENABLE_34),
	REGNAME(0x1228C, HW_CCF_CG_ENABLE_35),
	REGNAME(0x12290, HW_CCF_CG_ENABLE_36),
	REGNAME(0x12294, HW_CCF_CG_ENABLE_37),
	REGNAME(0x12298, HW_CCF_CG_ENABLE_38),
	REGNAME(0x1229C, HW_CCF_CG_ENABLE_39),
	REGNAME(0x122A0, HW_CCF_CG_ENABLE_40),
	REGNAME(0x122A4, HW_CCF_CG_ENABLE_41),
	REGNAME(0x122A8, HW_CCF_CG_ENABLE_42),
	REGNAME(0x122AC, HW_CCF_CG_ENABLE_43),
	REGNAME(0x122B0, HW_CCF_CG_ENABLE_44),
	REGNAME(0x122B4, HW_CCF_CG_ENABLE_45),
	REGNAME(0x122B8, HW_CCF_CG_ENABLE_46),
	REGNAME(0x122BC, HW_CCF_CG_ENABLE_47),
	REGNAME(0x122C0, HW_CCF_CG_ENABLE_48),
	REGNAME(0x122C4, HW_CCF_CG_ENABLE_49),
	REGNAME(0x122C8, HW_CCF_CG_ENABLE_50),
	REGNAME(0x122CC, HW_CCF_CG_ENABLE_51),
	REGNAME(0x12600, HW_CCF_CG_DONE_0),
	REGNAME(0x12604, HW_CCF_CG_DONE_1),
	REGNAME(0x12608, HW_CCF_CG_DONE_2),
	REGNAME(0x1260C, HW_CCF_CG_DONE_3),
	REGNAME(0x12610, HW_CCF_CG_DONE_4),
	REGNAME(0x12614, HW_CCF_CG_DONE_5),
	REGNAME(0x12618, HW_CCF_CG_DONE_6),
	REGNAME(0x1261C, HW_CCF_CG_DONE_7),
	REGNAME(0x12620, HW_CCF_CG_DONE_8),
	REGNAME(0x12624, HW_CCF_CG_DONE_9),
	REGNAME(0x12628, HW_CCF_CG_DONE_10),
	REGNAME(0x1262C, HW_CCF_CG_DONE_11),
	REGNAME(0x12630, HW_CCF_CG_DONE_12),
	REGNAME(0x12634, HW_CCF_CG_DONE_13),
	REGNAME(0x12638, HW_CCF_CG_DONE_14),
	REGNAME(0x1263C, HW_CCF_CG_DONE_15),
	REGNAME(0x12640, HW_CCF_CG_DONE_16),
	REGNAME(0x12644, HW_CCF_CG_DONE_17),
	REGNAME(0x12648, HW_CCF_CG_DONE_18),
	REGNAME(0x1264C, HW_CCF_CG_DONE_19),
	REGNAME(0x12650, HW_CCF_CG_DONE_20),
	REGNAME(0x12654, HW_CCF_CG_DONE_21),
	REGNAME(0x12658, HW_CCF_CG_DONE_22),
	REGNAME(0x1265C, HW_CCF_CG_DONE_23),
	REGNAME(0x12660, HW_CCF_CG_DONE_24),
	REGNAME(0x12664, HW_CCF_CG_DONE_25),
	REGNAME(0x12668, HW_CCF_CG_DONE_26),
	REGNAME(0x1266C, HW_CCF_CG_DONE_27),
	REGNAME(0x12670, HW_CCF_CG_DONE_28),
	REGNAME(0x12674, HW_CCF_CG_DONE_29),
	REGNAME(0x12678, HW_CCF_CG_DONE_30),
	REGNAME(0x1267C, HW_CCF_CG_DONE_31),
	REGNAME(0x12680, HW_CCF_CG_DONE_32),
	REGNAME(0x12684, HW_CCF_CG_DONE_33),
	REGNAME(0x12688, HW_CCF_CG_DONE_34),
	REGNAME(0x1268C, HW_CCF_CG_DONE_35),
	REGNAME(0x12690, HW_CCF_CG_DONE_36),
	REGNAME(0x12694, HW_CCF_CG_DONE_37),
	REGNAME(0x12698, HW_CCF_CG_DONE_38),
	REGNAME(0x1269C, HW_CCF_CG_DONE_39),
	REGNAME(0x126A0, HW_CCF_CG_DONE_40),
	REGNAME(0x126A4, HW_CCF_CG_DONE_41),
	REGNAME(0x126A8, HW_CCF_CG_DONE_42),
	REGNAME(0x126AC, HW_CCF_CG_DONE_43),
	REGNAME(0x126B0, HW_CCF_CG_DONE_44),
	REGNAME(0x126B4, HW_CCF_CG_DONE_45),
	REGNAME(0x126B8, HW_CCF_CG_DONE_46),
	REGNAME(0x126BC, HW_CCF_CG_DONE_47),
	REGNAME(0x126C0, HW_CCF_CG_DONE_48),
	REGNAME(0x126C4, HW_CCF_CG_DONE_49),
	REGNAME(0x126C8, HW_CCF_CG_DONE_50),
	REGNAME(0x126CC, HW_CCF_CG_DONE_51),
	REGNAME(0x11800, HW_CCF_CG_STATUS_0),
	REGNAME(0x11804, HW_CCF_CG_STATUS_1),
	REGNAME(0x11808, HW_CCF_CG_STATUS_2),
	REGNAME(0x1180C, HW_CCF_CG_STATUS_3),
	REGNAME(0x11810, HW_CCF_CG_STATUS_4),
	REGNAME(0x11814, HW_CCF_CG_STATUS_5),
	REGNAME(0x11818, HW_CCF_CG_STATUS_6),
	REGNAME(0x1181C, HW_CCF_CG_STATUS_7),
	REGNAME(0x11820, HW_CCF_CG_STATUS_8),
	REGNAME(0x11824, HW_CCF_CG_STATUS_9),
	REGNAME(0x11828, HW_CCF_CG_STATUS_10),
	REGNAME(0x1182C, HW_CCF_CG_STATUS_11),
	REGNAME(0x11830, HW_CCF_CG_STATUS_12),
	REGNAME(0x11834, HW_CCF_CG_STATUS_13),
	REGNAME(0x11838, HW_CCF_CG_STATUS_14),
	REGNAME(0x1183C, HW_CCF_CG_STATUS_15),
	REGNAME(0x11840, HW_CCF_CG_STATUS_16),
	REGNAME(0x11844, HW_CCF_CG_STATUS_17),
	REGNAME(0x11848, HW_CCF_CG_STATUS_18),
	REGNAME(0x1184C, HW_CCF_CG_STATUS_19),
	REGNAME(0x11850, HW_CCF_CG_STATUS_20),
	REGNAME(0x11854, HW_CCF_CG_STATUS_21),
	REGNAME(0x11858, HW_CCF_CG_STATUS_22),
	REGNAME(0x1185C, HW_CCF_CG_STATUS_23),
	REGNAME(0x11860, HW_CCF_CG_STATUS_24),
	REGNAME(0x11864, HW_CCF_CG_STATUS_25),
	REGNAME(0x11868, HW_CCF_CG_STATUS_26),
	REGNAME(0x1186C, HW_CCF_CG_STATUS_27),
	REGNAME(0x11870, HW_CCF_CG_STATUS_28),
	REGNAME(0x11874, HW_CCF_CG_STATUS_29),
	REGNAME(0x11878, HW_CCF_CG_STATUS_30),
	REGNAME(0x1187C, HW_CCF_CG_STATUS_31),
	REGNAME(0x11880, HW_CCF_CG_STATUS_32),
	REGNAME(0x11884, HW_CCF_CG_STATUS_33),
	REGNAME(0x11888, HW_CCF_CG_STATUS_34),
	REGNAME(0x1188C, HW_CCF_CG_STATUS_35),
	REGNAME(0x11890, HW_CCF_CG_STATUS_36),
	REGNAME(0x11894, HW_CCF_CG_STATUS_37),
	REGNAME(0x11898, HW_CCF_CG_STATUS_38),
	REGNAME(0x1189C, HW_CCF_CG_STATUS_39),
	REGNAME(0x118A0, HW_CCF_CG_STATUS_40),
	REGNAME(0x118A4, HW_CCF_CG_STATUS_41),
	REGNAME(0x118A8, HW_CCF_CG_STATUS_42),
	REGNAME(0x118AC, HW_CCF_CG_STATUS_43),
	REGNAME(0x118B0, HW_CCF_CG_STATUS_44),
	REGNAME(0x118B4, HW_CCF_CG_STATUS_45),
	REGNAME(0x118B8, HW_CCF_CG_STATUS_46),
	REGNAME(0x118BC, HW_CCF_CG_STATUS_47),
	REGNAME(0x118C0, HW_CCF_CG_STATUS_48),
	REGNAME(0x118C4, HW_CCF_CG_STATUS_49),
	REGNAME(0x118C8, HW_CCF_CG_STATUS_50),
	REGNAME(0x118CC, HW_CCF_CG_STATUS_51),
	/* MM_HWCCF HW_MTCMOS */
	REGNAME(0x14300, HW_CCF_HW_MTCMOS_REQ),
	REGNAME(0x14304, HW_CCF_HW_MTCMOS_DONE_ACK),
	REGNAME(0x14250, HW_CCF_HW_0_MTCMOS_ENABLE),
	REGNAME(0x14254, HW_CCF_HW_1_MTCMOS_ENABLE),
	REGNAME(0x14258, HW_CCF_HW_2_MTCMOS_ENABLE),
	REGNAME(0x1425C, HW_CCF_HW_3_MTCMOS_ENABLE),
	REGNAME(0x14260, HW_CCF_HW_4_MTCMOS_ENABLE),
	REGNAME(0x14264, HW_CCF_HW_5_MTCMOS_ENABLE),
	REGNAME(0x14268, HW_CCF_HW_6_MTCMOS_ENABLE),
	REGNAME(0x1426C, HW_CCF_HW_7_MTCMOS_ENABLE),
	REGNAME(0x14270, HW_CCF_HW_8_MTCMOS_ENABLE),
	REGNAME(0x14274, HW_CCF_HW_9_MTCMOS_ENABLE),
	REGNAME(0x14278, HW_CCF_HW_10_MTCMOS_ENABLE),
	REGNAME(0x1427C, HW_CCF_HW_11_MTCMOS_ENABLE),
	REGNAME(0x14280, HW_CCF_HW_12_MTCMOS_ENABLE),
	REGNAME(0x14284, HW_CCF_HW_13_MTCMOS_ENABLE),
	REGNAME(0x14288, HW_CCF_HW_14_MTCMOS_ENABLE),
	REGNAME(0x1428C, HW_CCF_HW_15_MTCMOS_ENABLE),
	REGNAME(0x14290, HW_CCF_HW_16_MTCMOS_ENABLE),
	REGNAME(0x14294, HW_CCF_HW_17_MTCMOS_ENABLE),
	REGNAME(0x14298, HW_CCF_HW_18_MTCMOS_ENABLE),
	REGNAME(0x1429C, HW_CCF_HW_19_MTCMOS_ENABLE),
	REGNAME(0x142A0, HW_CCF_HW_20_MTCMOS_ENABLE),
	REGNAME(0x142A4, HW_CCF_HW_21_MTCMOS_ENABLE),
	REGNAME(0x142A8, HW_CCF_HW_22_MTCMOS_ENABLE),
	REGNAME(0x142AC, HW_CCF_HW_23_MTCMOS_ENABLE),
	REGNAME(0x142B0, HW_CCF_HW_24_MTCMOS_ENABLE),
	REGNAME(0x142B4, HW_CCF_HW_25_MTCMOS_ENABLE),
	REGNAME(0x142B8, HW_CCF_HW_26_MTCMOS_ENABLE),
	REGNAME(0x142BC, HW_CCF_HW_27_MTCMOS_ENABLE),
	REGNAME(0x142C0, HW_CCF_HW_28_MTCMOS_ENABLE),
	REGNAME(0x142C4, HW_CCF_HW_29_MTCMOS_ENABLE),
	REGNAME(0x142C8, HW_CCF_HW_30_MTCMOS_ENABLE),
	/* MM_HWCCF IRQ REQ*/
	REGNAME(0x14400, HW_CCF_HW_IRQ_REQ),
	REGNAME(0x14404, HW_CCF_HW_IRQ_DONE_ACK),
	REGNAME(0x14330, HW_CCF_HW_0_IRQ_ENABLE),
	REGNAME(0x14334, HW_CCF_HW_1_IRQ_ENABLE),
	REGNAME(0x14338, HW_CCF_HW_2_IRQ_ENABLE),
	REGNAME(0x1433C, HW_CCF_HW_3_IRQ_ENABLE),
	REGNAME(0x14340, HW_CCF_HW_4_IRQ_ENABLE),
	REGNAME(0x14344, HW_CCF_HW_5_IRQ_ENABLE),
};

static int proc_hwccf_dump(struct seq_file *s, void *v)
{
	int i;
	char cmd[sizeof(last_cmd)];
	char *c = cmd;
	char *hwccf_cmd_str;
	char *hwccf_type_str;
	enum HWCCF_TYPE hwccf_type;

	strscpy(cmd, last_cmd, sizeof(cmd));
	cmd[sizeof(cmd) - 1UL] = '\0';

	hwccf_cmd_str = strsep(&c, " ");
	hwccf_type_str = strsep(&c, " ");

	if (hwccf_cmd_str == NULL || hwccf_type_str == NULL)
		return 0;

	if (strcmp(hwccf_type_str, "AP_HW_CCF") == 0)
		hwccf_type = AP_HWCCF;
	else if (strcmp(hwccf_type_str, "MM_HW_CCF") == 0)
		hwccf_type = MM_HWCCF;
	else
		return 0;

	for (i = 0; i < ARRAY_SIZE(hwccf_dump_regs); i++)
		seq_printf(s, "%s = 0x%x\n",
		hwccf_dump_regs[i].name,
		hwccf_read_wrapper(hwccf_type, hwccf_dump_regs[i].ofs));

	seq_puts(s, "\n");

	return 0;
}

static const struct cmd_fn common_cmds[] = {
	CMDFN("hwccf_voter", clkdbg_hwccf),
	CMDFN("hwccf_irq_voter", clkdbg_hwccf),
	CMDFN("hwccf_voter_smc", clkdbg_hwccf),
	CMDFN("hwccf_irq_voter_smc", clkdbg_hwccf),
	CMDFN("hwccf_irq_voter_no_wait_smc", clkdbg_hwccf),
	CMDFN("hwccf_dump", proc_hwccf_dump),
	CMDFN("cmds", hwccf_cmds),
	{}
};

static int hwccf_cmds(struct seq_file *s, void *v)
{
	const struct cmd_fn *cf;

	for (cf = common_cmds; cf->cmd != NULL; cf++)
		seq_printf(s, "%s\n", cf->cmd);

	seq_puts(s, "\n");

	return 0;
}





static int hwccf_show(struct seq_file *s, void *v)
{
	const struct cmd_fn *cf;
	char cmd[sizeof(last_cmd)];

	strscpy(cmd, last_cmd, sizeof(cmd));
	cmd[sizeof(cmd) - 1UL] = '\0';

	for (cf = common_cmds; cf->cmd != NULL; cf++) {
		char *c = cmd;
		char *token = strsep(&c, " ");

		if (strcmp(cf->cmd, token) == 0)
			return cf->fn(s, v);
	}

	return 0;
}

static int hwccf_proc_open(struct inode *inode, struct file *file)
{
	return single_open(file, hwccf_show, NULL);
}

static ssize_t hwccf_proc_write(
		struct file *file,
		const char __user *buffer,
		size_t count,
		loff_t *data)
{
	size_t len = 0;
	char *nl;

	len = (count < (sizeof(last_cmd) - 1UL)) ?
			count : (sizeof(last_cmd) - 1UL);
	if (copy_from_user(last_cmd, buffer, len) != 0UL)
		return 0;

	last_cmd[len] = '\0';

	nl = strchr(last_cmd, '\n');
	if (nl != NULL)
		*nl = '\0';

	return (ssize_t)len;
}

static const struct proc_ops hwccf_fops = {
	.proc_open              = hwccf_proc_open,
	.proc_read              = seq_read,
	.proc_write             = hwccf_proc_write,
	.proc_lseek             = seq_lseek,
	.proc_release   = single_release,
};


static int hwccf_proc_init;
int hwccf_proc_dbg_register(void)
{
	struct proc_dir_entry *entry;

	if (hwccf_proc_init == 1)
		return 0;

	entry = proc_create("hwccf_dbg", 0644, NULL, &hwccf_fops);

	if (entry == 0)
		return -ENOMEM;

	hwccf_proc_init = 1;
	return 0;
}
