// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright (c) 2019 MediaTek Inc.
 */

#include <linux/compiler.h>
#include <linux/dma-heap.h>
#include <linux/err.h>
#include <linux/kref.h>
#include <linux/slab.h>
#include <linux/types.h>
#include <linux/version.h>

#include <uapi/linux/dma-heap.h>

#include <mtk_heap.h>

#include "mtk_imgsys-engine-isp8.h"
#include "mtk-img-ipi.h"

#include "mtk-hcp_log.h"

#include "platform/mtk-hcp_data.h"
#include "platform/mtk-hcp_isp8_plat_f.h"


/* function prototype declaration */
static int impl_alloc(struct mtk_hcp_rsv_mb *mb);
static int impl_free(struct mtk_hcp_rsv_mb *mb);
static int impl_get_ref(struct mtk_hcp_rsv_mb *mb);
static int impl_put_ref(struct mtk_hcp_rsv_mb *mb);

/* declare macros: */
#define HCP_MOD_MB           (1)
#define HCP_GCE_MB           (2)
#define HCP_GCE_CLR_TOKEN_MB (3)

#define GET_MB_GP(x)    ((x >> 28) & 0xF)
#define GET_MEM_MODE(x) ((x >> 24) & 0xF)
#define GET_MOD_ID(x)   ((x >> 8) & 0xFFFF)
#define GET_MB_TYPE(x)  (x & 0xFF)

#define GET_MOD_MB_ID(mem_mode_id,mod_id, mb_type) \
	((HCP_MOD_MB << 28) | (mem_mode_id << 24) | (mod_id << 8) | (mb_type << 0))

#define GET_GCE_MB_ID(mem_mode_id) \
	((HCP_GCE_MB << 28) | (mem_mode_id << 24))

#define GET_GCE_CLR_TOKEN_MB_ID() \
	((HCP_GCE_CLR_TOKEN_MB << 28))

#define INIT_KREF_RSV_MB(_name, _size, _id ,_cache_mode) \
	.cfg = { \
		.name = _name, \
		.size = _size, \
		.id = _id, \
		.cache_mode = _cache_mode, \
	}, \
	.kref = KREF_INIT(0), \
	.map = {0}, \
	.d_buf = NULL, \
	.attach = NULL, \
	.sgt = NULL, \
	.fd = -1, \
	.start_phys = 0, \
	.start_dma = 0, \
	.start_virt = NULL, \
	.mem_priv = NULL, \
	.alloc = impl_alloc, \
	.free = impl_free, \
	.get_ref = impl_get_ref, \
	.put_ref = impl_put_ref,

#define INIT_RSV_MB(_name, _size, _id ,_cache_mode) \
	.cfg = { \
		.name = _name, \
		.size = _size, \
		.id = _id, \
		.cache_mode = _cache_mode, \
	}, \
	.kref = KREF_INIT(0), \
	.map = {0}, \
	.d_buf = NULL, \
	.attach = NULL, \
	.sgt = NULL, \
	.fd = -1, \
	.start_phys = 0, \
	.start_dma = 0, \
	.start_virt = NULL, \
	.mem_priv = NULL, \
	.alloc = impl_alloc, \
	.free = impl_free, \
	.get_ref = NULL, \
	.put_ref = NULL,

/* for convience, we define a macro to change cache_mode or not */
#define INIT_CQ_RSV_MB(_name, _size, _id) \
	INIT_RSV_MB(_name, _size, _id, HCP_MB_CACHE_OFF)

#define INIT_TDR_RSV_MB(_name, _size, _id) \
	INIT_RSV_MB(_name, _size, _id, HCP_MB_CACHE_OFF)

#define INIT_C_RSV_MB(_name, _size, _id) \
	INIT_RSV_MB(_name, _size, _id, HCP_MB_CACHE_ON)

#define INIT_NC_RSV_MB(_name, _size, _id) \
	INIT_RSV_MB(_name, _size, _id, HCP_MB_CACHE_OFF)

/* declared variables: */
static struct device *c_dev;
static struct device *nc_dev;
static struct device *acp_dev;

static struct mtk_hcp_rsv_mb mod_rsv_mb
	[IMGSYS_MEMORY_MODE_NUM_MAX]
	[IMGSYS_MOD_DRV_NUM_MAX]
	[IMGSYS_MODULE_WORKING_BUF_TYPE_NUM_MAX] = {
	{ /* IMGSYS_MEMORY_MODE_NORMAL_STREAMING */
		{ /* IMGSYS_MOD_DRV_WPE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_WPE_CQ",
					0x48000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_WPE_TDR",
					0x46000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_WPE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_WPE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_OMC */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_OMC_CQ",
					0x1B000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_OMC_TDR",
					0x20000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_OMC_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_OMC_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_ADL */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_ADL_CQ",
					0x1000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_ADL_TDR",
					0x1000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_ADL_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_ADL_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_TRAW */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_TRAW_CQ",
					0x251000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_TRAW_TDR",
					0x585000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_TRAW_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_TRAW_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DIP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_DIP_CQ",
					0x3BB000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_DIP_TDR",
					0x78D000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_DIP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_DIP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_PQDIP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_PQDIP_CQ",
					0x125000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_PQDIP_TDR",
					0xD9000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_PQDIP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_PQDIP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_ME */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_ME_CQ",
					0xF000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_ME_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_ME_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_ME_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_MAE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_MAE_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_MAE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_MAE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_MAE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DFP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_DFP_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_DFP_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_DFP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_DFP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DPE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"NS_DPE_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"NS_DPE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"NS_DPE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_DPE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_NORMAL_STREAMING,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
	},
	{ /* IMGSYS_MEMORY_MODE_CAPTURE */
		{ /* IMGSYS_MOD_DRV_WPE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_WPE_CQ",
					0x5000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_WPE_TDR",
					0xB000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_WPE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_WPE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_OMC */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_OMC_CQ",
					0x5000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_OMC_TDR",
					0x1000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_OMC_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_OMC_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_ADL */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_ADL_CQ",
					0x1000,
					GET_MOD_MB_ID(IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_ADL_TDR",
					0x1000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_ADL_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_ADL_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_TRAW */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_TRAW_CQ",
					0x84000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_TRAW_TDR",
					0x80A000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_TRAW_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_TRAW_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DIP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_DIP_CQ",
					0x1A2000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_DIP_TDR",
					0x92B000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_DIP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_DIP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_PQDIP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_PQDIP_CQ",
					0x31000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_PQDIP_TDR",
					0x21000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_PQDIP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_PQDIP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_ME */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_ME_CQ",
					0x5000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_ME_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_ME_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_ME_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_MAE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_MAE_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_MAE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_MAE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_MAE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DFP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_DFP_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_DFP_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_DFP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"NS_DFP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DPE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"CAP_DPE_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"CAP_DPE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"CAP_DPE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"CAP_DPE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_CAPTURE,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
	},
	{ /* IMGSYS_MEMORY_MODE_SMVR */
		{ /* IMGSYS_MOD_DRV_WPE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_WPE_CQ",
					0xD6000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_WPE_TDR",
					0x19F000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_WPE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_WPE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_OMC */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_OMC_CQ",
					0x4F000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_OMC_TDR",
					0x95000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_OMC_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_OMC_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_ADL */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_ADL_CQ",
					0x1000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_ADL_TDR",
					0x1000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_ADL_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_ADL_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_TRAW */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_TRAW_CQ",
					0x4A2000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_TRAW_TDR",
					0x72C000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_TRAW_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_TRAW_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DIP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_DIP_CQ",
					0x776000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_DIP_TDR",
					0xAC9000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_DIP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_DIP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_PQDIP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_PQDIP_CQ",
					0x24A000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_PQDIP_TDR",
					0x241000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_PQDIP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_PQDIP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_ME */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_ME_CQ",
					0x1D000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_ME_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_ME_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_ME_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_MAE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_MAE_CQ",
					0xF000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_MAE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_MAE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_MAE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DFP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_DFP_CQ",
					0xF000,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_DFP_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_DFP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_DFP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DPE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"SMVR_DPE_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"SMVR_DPE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"SMVR_DPE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"SMVR_DPE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_SMVR,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
	},
#if defined(IMGSYS_MEMORY_MODE_MAE)
	{ /* IMGSYS_MEMORY_MODE_MAE */
		{ /* IMGSYS_MOD_DRV_WPE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_WPE_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_WPE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_WPE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_WPE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_WPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_OMC */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_OMC_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_OMC_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_OMC_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_OMC_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_OMC,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_ADL */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_ADL_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_ADL_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_ADL_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_ADL_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_ADL,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_TRAW */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_TRAW_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_TRAW_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_TRAW_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_TRAW_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_TRAW,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DIP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_DIP_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_DIP_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_DIP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_DIP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_PQDIP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_PQDIP_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_PQDIP_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_PQDIP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_PQDIP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_PQDIP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_ME */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_ME_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_ME_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_ME_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_ME_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_ME,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_MAE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_MAE_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_MAE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_MAE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_MAE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_MAE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DFP */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_DFP_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_DFP_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_DFP_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_DFP_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DFP,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
		{ /* IMGSYS_MOD_DRV_DPE */
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_CQ */
				INIT_CQ_RSV_MB(
					"M_DPE_CQ",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_CQ))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_TDR */
				INIT_TDR_RSV_MB(
					"M_DPE_TDR",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_TDR))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC */
				INIT_C_RSV_MB(
					"M_DPE_C",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_C_MISC))
			},
			{ /* IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC */
				INIT_NC_RSV_MB(
					"M_DPE_NC",
					0,
					GET_MOD_MB_ID(
						IMGSYS_MEMORY_MODE_MAE,
						IMGSYS_MOD_DRV_DPE,
						IMGSYS_MODULE_WORKING_BUF_TYPE_NC_MISC))
			},
		},
	},
#endif
};

static struct mtk_hcp_rsv_mb gce_rsv_mb[IMGSYS_MEMORY_MODE_NUM_MAX] = {
	{ /* IMGSYS_MEMORY_MODE_NORMAL_STREAMING */
		INIT_KREF_RSV_MB(
			"NS_IMG_G",
			0x631000,
			GET_GCE_MB_ID(IMGSYS_MEMORY_MODE_NORMAL_STREAMING),
			HCP_MB_CACHE_ON)
	},
	{ /* IMGSYS_MEMORY_MODE_CAPTURE */
		INIT_KREF_RSV_MB(
			"CAP_IMG_G",
			0x4E5000,
			GET_GCE_MB_ID(IMGSYS_MEMORY_MODE_CAPTURE),
			HCP_MB_CACHE_ON)
	},
	{ /* IMGSYS_MEMORY_MODE_SMVR */
		INIT_KREF_RSV_MB(
			"SMVR_IMG_G",
			0xE88400,
			GET_GCE_MB_ID(IMGSYS_MEMORY_MODE_SMVR),
			HCP_MB_CACHE_ON)
	},
#if defined(IMGSYS_MEMORY_MODE_MAE)
	{
		INIT_KREF_RSV_MB(
			"M_IMG_G",
			0,
			GET_GCE_MB_ID(IMGSYS_MEMORY_MODE_MAE),
			HCP_MB_CACHE_ON)
	},
#endif
};

static struct mtk_hcp_rsv_mb gce_clr_token_rsv_mb = {
	INIT_C_RSV_MB(
		"IMG_CLR_TOKEN",
		0x200,
		GET_GCE_CLR_TOKEN_MB_ID())
};

static int free_mb(struct mtk_hcp_rsv_mb *mb)
{
	int ret = 0;

	if (IS_ERR_OR_NULL(mb->d_buf) ||
		     IS_ERR_OR_NULL(mb->sgt) ||
		     (-1 == mb->fd)) {
		if (mb->cfg.size != 0) {
			HCP_PRINT_WRN(" %s mb haven't been allocated before?\n", mb->cfg.name);
			ret = -EINVAL;
		}
	} else {
#if KERNEL_VERSION(6, 6, 0) <= LINUX_VERSION_CODE
		dma_buf_vunmap_unlocked(mb->d_buf	, &mb->map);
		dma_buf_unmap_attachment_unlocked(
			mb->attach,
			mb->sgt,
			DMA_BIDIRECTIONAL);
#else
		dma_buf_vunmap(mb->d_buf, &mb->map);
		dma_buf_unmap_attachment(mb->attach, mb->sgt, DMA_BIDIRECTIONAL);
#endif
		dma_buf_detach(mb->d_buf, mb->attach);
		if (mb->cfg.cache_mode == HCP_MB_CACHE_ON)
			dma_buf_end_cpu_access(mb->d_buf, DMA_BIDIRECTIONAL);
		dma_buf_put(mb->d_buf);
	}

	if (mb->cfg.size != 0) {
		HCP_PRINT_INF("dma_buf(%s) fd(%d) sz(%llu)\n",
				mb->cfg.name, mb->fd, mb->cfg.size);
		/* virt and dma only can print at debug lvl */
		HCP_PRINT_DBG("dma_buf(%s) (%p) virt(%p) dma(0x%llX)\n",
			mb->cfg.name, mb->d_buf, mb->start_virt, mb->start_dma);
	}

	/* clear mb */
	mb->d_buf = NULL;
	mb->attach = NULL;
	mb->sgt = NULL;
	mb->fd = -1;
	mb->start_dma = 0;
	mb->start_phys = 0;
	mb->start_virt = NULL;
	mb->mem_priv = NULL;

	return ret;
}

static int impl_alloc(struct mtk_hcp_rsv_mb *mb)
{
	int ret = 0;
	struct device *mmu_dev = NULL;
	struct dma_heap *heap = NULL;
	char *heap_name = NULL;
	struct dma_buf *d_buf = NULL;
	struct dma_buf_attachment *attachment = NULL;
	struct sg_table *sgt = NULL;
	struct iosys_map map = {0};
	dma_addr_t start_dma = 0;
	void *start_virt = NULL;
	int fd = -1;

	if (unlikely(mb == NULL))
		return -EFAULT;

	/* return success due to no need to allocate */
	if (unlikely(mb->cfg.size == 0)) {
		HCP_PRINT_DBG("mb(%u/%s) size is zero\n", mb->cfg.id, mb->cfg.name);
		return 0;
	}

	if (unlikely(-1 != mb->fd)) {
		HCP_PRINT_WRN("fd(%d) mb(%u/%s) already allocated! free it at first\n",
			mb->fd, mb->cfg.id, mb->cfg.name);
		if (mb->get_ref || mb->put_ref)
			HCP_PRINT_INF("mb(%u/%s) ref count:%d\n", mb->cfg.id, mb->cfg.name, kref_read(&mb->kref));

		free_mb(mb);
		/* return 0; */
	}

	/* all supported heap name you can find with cmd */
	/* (ls /dev/dma_heap/) in shell */
	switch (mb->cfg.cache_mode) {
	case HCP_MB_CACHE_OFF:
		heap_name = "mtk_mm-uncached";
		mmu_dev = nc_dev;
		break;
	case HCP_MB_CACHE_ON:
		heap_name = "mtk_mm";
		mmu_dev = c_dev;
		break;
	case HCP_MB_CACHE_ACP:
		if (likely(acp_dev != NULL)) {
			heap_name = "mtk_mm";
			mmu_dev = acp_dev;
		} else {
			heap_name = "mtk_mm-uncached";
			mmu_dev = nc_dev;
			HCP_PRINT_WRN("no acp dev found, use nc dev\n");
		}
		break;
	default:
		HCP_PRINT_WRN("Unknown cache mode(%u)\n", mb->cfg.cache_mode);
		heap_name = "mtk_mm-uncached";
		mmu_dev = nc_dev;
		break;
	}

	heap = dma_heap_find(heap_name);

	if (unlikely(!heap)) {
		HCP_PRINT_ERR("can't get heap of (%u/%s)\n",
			mb->cfg.cache_mode, heap_name);
		ret = -ENXIO;
		goto error;
	}

	if (unlikely(!mmu_dev)) {
		HCP_PRINT_ERR("mmu dev of cache mode(%u) is NULL\n", mb->cfg.cache_mode);
		ret = ENXIO;
		goto error;
	}

	d_buf = dma_heap_buffer_alloc(
		heap,
		mb->cfg.size,
		O_RDWR | O_CLOEXEC,
		DMA_HEAP_VALID_HEAP_FLAGS);

	if (IS_ERR_OR_NULL(d_buf)) {
		ret = d_buf ? (int)PTR_ERR(d_buf) : -ENOMEM;
		HCP_PRINT_ERR("dma_buf(%s) alloc sz(0x%llx) fail %d\n",
			mb->cfg.name, mb->cfg.size, ret);
		goto error;
	}

	if (unlikely(mtk_dma_buf_set_name(d_buf, mb->cfg.name) != 0))
		HCP_PRINT_WRN("dma_buf(%s) set name fail", mb->cfg.name);

	attachment = dma_buf_attach(d_buf, mmu_dev);
	if (IS_ERR_OR_NULL(attachment)) {
		ret = attachment ? (int)PTR_ERR(attachment) : -ENOMEM;
		HCP_PRINT_ERR("dma_buf(%s) sz(0x%llx) attach fail %d\n",
			mb->cfg.name, mb->cfg.size, ret);
		goto error;
	}

#if KERNEL_VERSION(6, 6, 0) <= LINUX_VERSION_CODE
	sgt = dma_buf_map_attachment_unlocked(attachment, DMA_BIDIRECTIONAL);
#else
	sgt = dma_buf_map_attachment(attachment, DMA_BIDIRECTIONAL);
#endif
	if (IS_ERR_OR_NULL(sgt)) {
		ret = sgt ? (int)PTR_ERR(sgt) : -ENOMEM;
		HCP_PRINT_ERR("dma_buf(%s) sz(0x%llx) map_attachment fail %d\n",
			mb->cfg.name, mb->cfg.size, ret);
		goto error;
	}

	start_dma = sg_dma_address(sgt->sgl);

#if KERNEL_VERSION(6, 6, 0) <= LINUX_VERSION_CODE
	ret = dma_buf_vmap_unlocked(d_buf, &map);
#else
	ret = dma_buf_vmap(d_buf, &map);
#endif
	if (unlikely(ret)) {
		HCP_PRINT_ERR("dma_buf(%s) sz(0x%llx) vmap fail %d\n",
			mb->cfg.name, mb->cfg.size, ret);
		goto error;
	}

	start_virt = map.vaddr;
	get_dma_buf(d_buf);
	fd = dma_buf_fd(d_buf, O_RDWR | O_CLOEXEC);

	if (mb->cfg.cache_mode == HCP_MB_CACHE_ON)
		dma_buf_begin_cpu_access(d_buf, DMA_BIDIRECTIONAL);

error:
	if (likely(ret == 0)) {
		mb->d_buf = d_buf;
		mb->attach = attachment;
		mb->sgt = sgt;
		mb->start_dma = start_dma;
		mb->start_phys = start_dma;
		mb->start_virt = start_virt;
		mb->map = map;
		mb->fd = fd;
		/* determine whether is a kref_mb */
		if (unlikely(mb->get_ref && mb->put_ref))
			kref_init(&mb->kref);

		HCP_PRINT_INF("mem_mode(%u) dma_buf(%s) fd(%d) sz(0x%llx)\n",
			GET_MEM_MODE(mb->cfg.id), mb->cfg.name, mb->fd, mb->cfg.size);
		/* virt and dma only can print at debug lvl */
		HCP_PRINT_DBG("mb:%p, mem_mode(%u), dma_buf(%s) (%p) virt(%p) dma(0x%llX)\n",
			mb, GET_MEM_MODE(mb->cfg.id), mb->cfg.name,
			mb->d_buf, mb->start_virt, mb->start_dma);
	} else {
#if KERNEL_VERSION(6, 6, 0) <= LINUX_VERSION_CODE
		if (!IS_ERR_OR_NULL(attachment) && !IS_ERR_OR_NULL(sgt) && start_dma)
			dma_buf_unmap_attachment_unlocked(
				attachment,
				sgt,
				DMA_BIDIRECTIONAL);

#else
		if (!IS_ERR_OR_NULL(attachment) && !IS_ERR_OR_NULL(sgt) && start_dma)
			dma_buf_unmap_attachment(
				attachment,
				sgt,
				DMA_BIDIRECTIONAL);
#endif
		if (!IS_ERR_OR_NULL(d_buf) && !IS_ERR_OR_NULL(attachment))
			dma_buf_detach(d_buf, attachment);
		if (!IS_ERR_OR_NULL(d_buf))
			dma_buf_put(d_buf);
	}

	return ret;
}

static void release_mb(struct kref *ref)
{
	struct mtk_hcp_rsv_mb *mb =
		container_of(ref, struct mtk_hcp_rsv_mb, kref);

	int ret = free_mb(mb);

	if (unlikely(ret))
		HCP_PRINT_ERR("free mb(%s) failed(%d)\n", mb->cfg.name, ret);
	else
		HCP_PRINT_DBG("free mb(%s)\n", mb->cfg.name);


}

/* implementation of the above declared functions */
static int impl_get_ref(struct mtk_hcp_rsv_mb *mb)
{
	int ret = 0;

	if (unlikely(mb == NULL))
		return -EFAULT;

	kref_get(&mb->kref);

	if (GET_MEM_MODE(mb->cfg.id) == IMGSYS_MEMORY_MODE_SMVR)
		HCP_PRINT_DBG("%s ref:%d\n", mb->cfg.name, kref_read(&mb->kref));
	else
		HCP_PRINT_DBG("%s ref:%d\n", mb->cfg.name, kref_read(&mb->kref));

	return ret;
}

static int impl_put_ref(struct mtk_hcp_rsv_mb *mb)
{
	int ret = 0;

	if (unlikely(mb == NULL))
		return -EFAULT;

	/* To avoid ref_count saturation */
	if (unlikely(mb->fd == -1)) {
		if (mb->cfg.size) {
			HCP_PRINT_WRN("%s haven't been allocated\n", mb->cfg.name);
			return -EFAULT;
		} else {
			return ret;
		}
	}

	/* determine whether is a kref_mb */
	if (likely(kref_put(&mb->kref, release_mb) == 0)) {
		if (GET_MEM_MODE(mb->cfg.id) == IMGSYS_MEMORY_MODE_SMVR)
			HCP_PRINT_DBG("%s ref:%d\n", mb->cfg.name, kref_read(&mb->kref));
	}

	return ret;
}

static int impl_free(struct mtk_hcp_rsv_mb *mb)
{
	int ret = 0;

	if (unlikely(mb == NULL))
		return -EFAULT;

	/* determine whether is a kref_mb */
	if (unlikely(mb->put_ref))
		ret = impl_put_ref(mb);
	else
		ret = free_mb(mb);

	return ret;
}


/* data ops */
static struct mtk_hcp_rsv_mb *fetch_mod_mb(
	unsigned int mem_mode,
	unsigned int mod_id,
	unsigned int mb_type)
{
	if (likely((mem_mode < IMGSYS_MEMORY_MODE_NUM_MAX) &&
		   (mod_id < IMGSYS_MOD_DRV_NUM_MAX) &&
		   (mb_type < IMGSYS_MODULE_WORKING_BUF_TYPE_NUM_MAX)))
		return &mod_rsv_mb[mem_mode][mod_id][mb_type];
	else
		return NULL;
}

static struct mtk_hcp_rsv_mb *fetch_gce_mb(unsigned int mem_mode)
{
	if (likely(mem_mode < IMGSYS_MEMORY_MODE_NUM_MAX))
		return &gce_rsv_mb[mem_mode];
	else
		return NULL;
}

static struct mtk_hcp_rsv_mb *fetch_gce_clr_token_mb(unsigned int mem_mode)
{
	return &gce_clr_token_rsv_mb;
}

static struct mtk_hcp_rsv_mb *fetch_mb(
	unsigned int mb_id)
{
	struct mtk_hcp_rsv_mb *mb = NULL;

	switch (GET_MB_GP(mb_id)) {
	case HCP_MOD_MB:
		mb = fetch_mod_mb(
			GET_MEM_MODE(mb_id),
			GET_MOD_ID(mb_id),
			GET_MB_TYPE(mb_id));
		break;
	case HCP_GCE_MB:
		mb = fetch_gce_mb(GET_MEM_MODE(mb_id));
		break;
	case HCP_GCE_CLR_TOKEN_MB:
		mb = fetch_gce_clr_token_mb(GET_MEM_MODE(mb_id));
		break;
	default:
		HCP_PRINT_WRN("unknown mb_gp(%u) of mb_id(%u)\n", GET_MB_GP(mb_id), mb_id);
		break;
	}

	if (mb)
		HCP_PRINT_DBG("mb_id(%u) -> name:(%s) mb_gp(%u) mem_mode(%u)\n ",
			mb_id, mb->cfg.name, GET_MB_GP(mb_id), GET_MEM_MODE(mb_id));

	return mb;
}

static void set_c_dev(struct device *dev)
{
	c_dev = dev;
}

static void set_nc_dev(struct device *dev)
{
	nc_dev = dev;
}

static void set_acp_dev(struct device *dev)
{
	acp_dev = dev;
}

struct mtk_hcp_plat_op plat_op_isp8_f = {
	.fetch_mb = fetch_mb,
	.fetch_mod_mb = fetch_mod_mb,
	.fetch_gce_mb = fetch_gce_mb,
	.fetch_gce_clr_token_mb = fetch_gce_clr_token_mb,
	.set_c_dev = set_c_dev,
	.set_nc_dev = set_nc_dev,
	.set_acp_dev = set_acp_dev,
};



